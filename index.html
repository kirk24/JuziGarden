<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Ê°îÂ≠êÁöÑÂãáÊ∞îËä±Âõ≠ ¬∑ Âë®ÊåëÊàò</title>
    <style>
        :root {
            --pink: #FF69B4;
            --pink-light: #FFB6C1;
            --purple: #9370DB;
            --indigo: #4B0082;
            --lavender-blush: #FFF0F5;
            --card-shadow: rgba(255, 121, 198, 0.25);
            --soft-white: #FFFAFE;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Fredoka', 'PingFang SC', 'Comic Sans MS', 'Microsoft YaHei', sans-serif;
            background: var(--lavender-blush);
            min-height: 100dvh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            color: var(--indigo);
            padding-bottom: calc(10px + env(safe-area-inset-bottom));
        }

        .garden {
            width: min(960px, 100%);
            background: var(--soft-white);
            border-radius: 30px;
            box-shadow: 0 25px 60px var(--card-shadow);
            padding: clamp(16px, 3vw, 32px);
            border: 4px solid rgba(255, 105, 180, 0.2);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header-compact {
            margin-bottom: 8px;
        }

        h1 {
            font-size: clamp(24px, 4vw, 42px);
            margin-bottom: 4px;
            color: var(--pink);
            text-shadow: 0 4px 0 rgba(255, 255, 255, 0.6);
            letter-spacing: 1px;
        }

        .subtitle {
            font-size: clamp(14px, 2.5vw, 16px);
            color: #a14f7f;
            margin-bottom: 12px;
        }

        .calendar-stats-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 16px;
            padding: 12px 16px;
            background: #FFF0F5;
            border-radius: 16px;
            border: 1px solid rgba(255, 105, 180, 0.15);
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .stat-icon {
            font-size: 20px;
        }

        .stat-label {
            font-size: 12px;
            color: #a14f7f;
            font-weight: 600;
        }

        .stat-value {
            font-size: 18px;
            color: var(--pink);
            font-weight: 700;
        }

        .dashboard-card {
            background: #FFFFFF;
            border-radius: 20px;
            padding: clamp(16px, 3vw, 24px);
            border: 3px solid rgba(255, 105, 180, 0.2);
            box-shadow: inset 0 0 0 2px rgba(255, 255, 255, 0.9);
            margin-bottom: 16px;
        }

        .progress-section {
            margin-bottom: 8px;
        }

        .progress-hint {
            text-align: center;
            font-size: clamp(14px, 2.5vw, 16px);
            color: var(--purple);
            margin-bottom: 12px;
            font-weight: 600;
        }

        .progress-bar-container {
            position: relative;
            width: 100%;
            height: 32px;
            background: rgba(255, 105, 180, 0.15);
            border-radius: 16px;
            overflow: hidden;
        }

        .progress-bar {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF69B4 0%, #9370DB 100%);
            border-radius: 16px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .progress-marker {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            font-size: 24px;
            opacity: 0.6;
            z-index: 2;
        }

        .section-title.small {
            font-size: clamp(14px, 2.5vw, 16px);
            margin-bottom: 8px;
        }

        .divider {
            height: 1px;
            background: rgba(255, 105, 180, 0.15);
            margin: 10px 0;
        }

        .action-area {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            width: 100%;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            width: 100%;
        }

        .action-btn {
            border: none;
            border-radius: 16px;
            padding: 14px 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            touch-action: manipulation;
            position: relative;
        }

        .action-btn:active {
            transform: scale(0.9);
        }

        .btn-excellent {
            animation: pulse-gold 2s ease-in-out infinite;
        }

        @keyframes pulse-gold {
            0%, 100% {
                box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
            }
            50% {
                box-shadow: 0 8px 24px rgba(255, 215, 0, 0.6), 0 0 0 4px rgba(255, 215, 0, 0.2);
            }
        }

        .btn-emoji {
            font-size: 28px;
        }

        .btn-text {
            font-size: clamp(13px, 2.5vw, 15px);
            font-weight: 600;
            color: white;
        }

        .btn-score {
            font-size: 12px;
            font-weight: 700;
            opacity: 0.9;
            color: rgba(255, 255, 255, 0.9);
        }

        .btn-kindergarten {
            background: linear-gradient(135deg, #FF69B4 0%, #FF8EC7 100%);
        }

        .btn-interest {
            background: linear-gradient(135deg, #9370DB 0%, #B19CD9 100%);
        }

        .btn-excellent {
            background: linear-gradient(135deg, #FFA500 0%, #FFD700 100%);
        }

        .btn-hug {
            background: linear-gradient(135deg, #B0E4FF 0%, #9AD0F5 100%);
        }

        .btn-hug .btn-text {
            color: #24557a;
        }

        .btn-hug .btn-score {
            color: rgba(255, 255, 255, 0.9);
        }

        .section {
            position: relative;
            z-index: 1;
            margin-bottom: clamp(24px, 4vw, 36px);
        }

        .section-card {
            background: #FFFFFF;
            border-radius: 24px;
            padding: clamp(20px, 4vw, 32px);
            border: 3px solid rgba(255, 105, 180, 0.2);
            box-shadow: inset 0 0 0 2px rgba(255, 255, 255, 0.9);
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--purple);
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .pits {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 18px;
            margin: 10px auto 20px;
        }

        .pits.small-pits {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: clamp(8px, 2vw, 12px);
            margin: 8px auto 12px;
            padding: 0;
        }

        .pit {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: transform 0.2s ease;
            position: relative;
        }

        .pit:hover {
            transform: translateY(-2px);
        }

        .pit.selected .pit-circle {
            box-shadow: 0 0 0 4px rgba(255, 105, 180, 0.5), 0 0 20px rgba(147, 112, 219, 0.6);
            border-width: 4px;
        }

        .delete-btn {
            position: absolute;
            top: -6px;
            right: -6px;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.9);
            color: #AAAAAA;
            border: 1px solid #E0E0E0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
            line-height: 1;
        }

        .delete-btn:hover {
            background: #F0F0F0;
            color: #888888;
            transform: scale(1.1);
        }

        .delete-btn:active {
            transform: scale(0.95);
        }

        .pit-circle {
            width: clamp(70px, 12vw, 110px);
            aspect-ratio: 1 / 1;
            border-radius: 50%;
            border: 3px dashed rgba(147, 112, 219, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(28px, 5vw, 48px);
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
        }

        .small-pits .pit-circle {
            width: 64px;
            height: 64px;
            font-size: 28px;
            border-width: 3px;
        }

        .small-pits .pit-label {
            font-size: 12px;
        }

        .small-pits .pit {
            gap: 4px;
        }

        .pit-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--indigo);
        }

        .pit-circle.success {
            background: radial-gradient(circle at top, #FFD6F2 0%, #FFB0E0 70%, #FF92D2 100%);
            border-color: var(--pink);
            box-shadow: 0 10px 25px rgba(255, 105, 180, 0.3);
        }

        .pit-circle.fail {
            background: #F5F1F7;
            border-color: #C0C0C0;
            color: #9E9E9E;
        }

        .pit-circle.today {
            border-style: solid;
            border-color: var(--purple);
            animation: pulse 1.5s infinite;
        }

        .pit-circle.empty {
            color: rgba(75, 0, 130, 0.2);
            border-style: dashed;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(147, 112, 219, 0.4); }
            70% { box-shadow: 0 0 0 12px rgba(147, 112, 219, 0); }
            100% { box-shadow: 0 0 0 0 rgba(147, 112, 219, 0); }
        }

        .grand-prize {
            margin-top: 12px;
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .grand-prize.active { display: flex; }

        .gift-box {
            width: clamp(60px, 15vw, 80px);
            aspect-ratio: 1 / 1;
            background: radial-gradient(circle, #FF9BD4 0%, #FF7FC0 60%, #F053AF 100%);
            border-radius: 16px;
            box-shadow: 0 10px 20px rgba(255, 126, 204, 0.35);
            position: relative;
            cursor: pointer;
            animation: wobble 1.5s ease-in-out infinite;
            touch-action: manipulation;
        }

        .gift-box::before,
        .gift-box::after {
            content: '';
            position: absolute;
            background: rgba(255, 255, 255, 0.7);
        }

        .gift-box::before {
            width: 20%;
            height: 100%;
            left: 50%;
            top: 0;
            transform: translateX(-50%);
        }

        .gift-box::after {
            width: 100%;
            height: 22%;
            top: 40%;
            left: 0;
        }

        .gift-icon {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(30px, 8vw, 50px);
            color: white;
        }

        .calendar-section {
            margin-top: 16px;
        }

        .restart-btn {
            border: none;
            background: linear-gradient(135deg, #FFB6C1 0%, #FF69B4 100%);
            color: #7c1c5c;
            padding: 12px 26px;
            border-radius: 999px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(255, 121, 198, 0.35);
        }

        @keyframes wobble {
            0%, 100% { transform: rotate(-2deg); }
            50% { transform: rotate(2deg); }
        }

        .date-hint {
            text-align: center;
            font-size: clamp(12px, 2.5vw, 14px);
            color: var(--purple);
            margin-bottom: 8px;
            padding: 8px;
            background: rgba(255, 240, 245, 0.6);
            border-radius: 10px;
            font-weight: 600;
        }

        .actions {
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        .big-btn {
            border: none;
            border-radius: 18px;
            padding: clamp(12px, 3vw, 16px);
            font-size: clamp(16px, 3.5vw, 22px);
            font-weight: 700;
            color: white;
            cursor: pointer;
            transition: transform 0.15s ease, box-shadow 0.15s ease;
            box-shadow: 0 8px 18px rgba(0, 0, 0, 0.12);
            touch-action: manipulation;
            flex: 1;
        }

        .big-btn.green {
            background: linear-gradient(135deg, var(--pink) 0%, var(--purple) 100%);
        }

        .big-btn.blue {
            background: linear-gradient(135deg, #B0E4FF 0%, #9AD0F5 100%);
            color: #24557a;
        }

        .big-btn:active {
            transform: scale(0.96);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        .calendar {
            display: grid;
            gap: 14px;
        }

        .calendar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            font-size: 16px;
            font-weight: 600;
            color: #a166c2;
            background: #FFF0F5;
            padding: 8px 16px;
            border-radius: 20px;
            margin-bottom: 12px;
        }

        .month-nav-btn {
            background: transparent;
            border: none;
            color: var(--purple);
            font-size: 18px;
            padding: 0 16px;
            cursor: pointer;
            transition: transform 0.2s ease, opacity 0.2s ease;
            touch-action: manipulation;
        }

        .month-nav-btn:hover {
            opacity: 0.7;
            transform: scale(1.1);
        }

        .month-nav-btn:active {
            transform: scale(0.95);
        }

        #calendarMonthLabel {
            flex: 1;
            text-align: center;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, minmax(32px, 1fr));
            gap: 8px;
            text-align: center;
        }

        .calendar-cell {
            background: #FFF8FD;
            border-radius: 12px;
            padding: 4px;
            aspect-ratio: 1/1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            font-size: 12px;
            color: #a166c2;
            border: 2px solid transparent;
            box-shadow: inset 0 -3px 0 rgba(255, 105, 180, 0.08);
        }

        .calendar-cell .calendar-day-label {
            position: absolute;
            top: 4px;
            left: 6px;
            font-size: 12px;
            font-weight: 600;
            color: #a166c2;
            line-height: 1;
        }

        .calendar-cell.today {
            border-color: var(--purple);
            box-shadow: 0 8px 18px rgba(147, 112, 219, 0.25);
        }

        .calendar-cell.success {
            background: radial-gradient(circle, #FFE2F4 0%, #FFC3EB 100%);
            color: var(--pink);
        }

        .calendar-cell.fail {
            background: radial-gradient(circle, #F3F0FF 0%, #DBCFF7 100%);
            color: #6f4fa1;
        }

        .calendar-cell .emoji {
            font-size: 32px;
            line-height: 1;
        }

        .calendar-score {
            display: none;
        }

        .calendar-emoji {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: row;
            gap: 2px;
            line-height: 1;
        }

        .calendar-prize {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: clamp(24px, 5vw, 28px);
            line-height: 1;
        }

        .cal-icon {
            font-size: clamp(24px, 5vw, 28px);
            line-height: 1;
            display: inline-block;
        }

        .cal-count {
            font-size: 11px;
            font-weight: 700;
            color: #d63384;
            line-height: 1;
            display: inline-block;
            align-self: flex-end;
            margin-bottom: 2px;
        }


        .calendar-weekday {
            font-size: 13px;
            font-weight: 700;
            color: #b48ac7;
        }

        .floating-feedback {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: clamp(80px, 20vw, 120px);
            z-index: 9999;
            pointer-events: none;
            visibility: hidden;
            opacity: 0;
            text-align: center;
            line-height: 1;
        }

        .floating-feedback.active {
            visibility: visible;
            animation: popAndFloataway 2.5s cubic-bezier(0.25, 0.8, 0.25, 1) forwards;
        }

        .floating-feedback.mega-pop {
            font-size: clamp(104px, 26vw, 156px);
        }

        .floating-feedback.mega-pop.active {
            animation: megaPopAndFloataway 2.5s cubic-bezier(0.25, 0.8, 0.25, 1) forwards;
        }

        @keyframes popAndFloataway {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0);
            }
            20% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.5);
            }
            40% {
                opacity: 1;
                transform: translate(-50%, -52%) scale(1);
            }
            60% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -70%) scale(0.6);
            }
        }

        @keyframes megaPopAndFloataway {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0) rotate(0deg);
            }
            20% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.5) rotate(0deg);
            }
            40% {
                opacity: 1;
                transform: translate(-50%, -52%) scale(1) rotate(180deg);
            }
            60% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1) rotate(360deg);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -70%) scale(0.6) rotate(360deg);
            }
        }

        .floating-loss {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: clamp(80px, 20vw, 120px);
            z-index: 9999;
            pointer-events: none;
            visibility: hidden;
            opacity: 0;
            text-align: center;
            line-height: 1;
        }

        .floating-loss.active {
            visibility: visible;
            animation: sadDrop 1.5s cubic-bezier(0.4, 0, 0.6, 1) forwards;
        }

        @keyframes sadDrop {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0);
                filter: grayscale(0%);
            }
            20% {
                opacity: 0.8;
                transform: translate(-50%, -50%) scale(1) rotate(-10deg);
                filter: grayscale(0%);
            }
            40% {
                opacity: 0.6;
                transform: translate(-50%, -50%) scale(1) rotate(10deg);
                filter: grayscale(100%);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, calc(-50% + 150px)) scale(0.5) rotate(45deg);
                filter: grayscale(100%);
            }
        }

        .encourage-tip,
        .modal {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.28);
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.25s ease;
            z-index: 40;
        }

        .encourage-tip.active,
        .modal.active {
            visibility: visible;
            opacity: 1;
        }

        .tip-card,
        .modal-card {
            background: #FFF6E6;
            border-radius: 24px;
            padding: clamp(24px, 5vw, 36px);
            text-align: center;
            border: 4px solid #FFD6A0;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.22);
            font-size: 22px;
            color: #FF7E54;
            max-width: 320px;
            animation: popIn 0.35s ease;
        }

        .modal-card {
            max-width: 420px;
        }

        .modal-card h2 {
            font-size: clamp(26px, 4vw, 34px);
            color: #FF8A00;
            margin-bottom: 16px;
        }

        .modal-card p {
            font-size: clamp(18px, 4vw, 22px);
            color: #C56D2C;
            margin-bottom: 20px;
        }

        .modal-close {
            border: none;
            padding: 12px 26px;
            border-radius: 20px;
            background: linear-gradient(135deg, var(--pink) 0%, var(--purple) 100%);
            color: white;
            font-size: 18px;
            cursor: pointer;
        }

        @keyframes popIn {
            0% { transform: scale(0.7); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        @media (max-width: 640px) {
            .calendar-grid {
                gap: 6px;
            }
            .calendar-cell {
                padding: 3px;
            }
            .calendar-day-label {
                font-size: 11px;
                top: 3px;
                left: 4px;
            }
            .calendar-emoji,
            .calendar-prize {
                font-size: clamp(20px, 4vw, 24px);
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 12px;
                padding-bottom: calc(12px + env(safe-area-inset-bottom));
            }

            .garden {
                border-width: 4px;
            }

            .section {
                margin-bottom: 20px;
            }

            .pits {
                gap: 12px;
            }

            .calendar-stats-bar {
                gap: 16px;
                padding: 10px 12px;
            }

            .stat-item {
                gap: 3px;
            }

            .stat-icon {
                font-size: 18px;
            }

            .stat-label {
                font-size: 11px;
            }

            .stat-value {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="garden">
        <div class="header-compact">
            <h1>üçä Ê°îÂ≠êÁöÑÂãáÊ∞îËä±Âõ≠ üçä</h1>
            <p class="subtitle">ÊîíÊª° 7 ‰∏™Ê°îÂ≠êËé∑ÂæóÁ§ºÁâ©ÔºÅ</p>
        </div>

        <div class="dashboard-card">
            <div class="progress-section">
                <div class="progress-hint" id="progressHint">Ë∑ùÁ¶ªÁ§ºÁâ©ËøòÊúâ 7 ‰∏™Ê°îÂ≠ê</div>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progressBar">
                        <div class="progress-fill" id="progressFill"></div>
                        <div class="progress-marker">üéÅ</div>
                    </div>
                </div>
            </div>

            <div class="divider"></div>

            <div class="action-area">
                <div class="date-hint" id="dateHint">üìù Ê≠£Âú®ËÆ∞ÂΩïÔºö‰ªäÂ§©</div>
                <div class="action-buttons" id="actionButtons">
                    <button class="action-btn btn-kindergarten" data-score="1">
                        <span class="btn-emoji">üè´</span>
                        <span class="btn-text">ÂπºÂÑøÂõ≠</span>
                        <span class="btn-score">+1</span>
                    </button>
                    <button class="action-btn btn-interest" data-score="1">
                        <span class="btn-emoji">üé®</span>
                        <span class="btn-text">ÂÖ¥Ë∂£ËØæ</span>
                        <span class="btn-score">+1</span>
                    </button>
                    <button class="action-btn btn-excellent" data-score="2">
                        <span class="btn-emoji">üåü</span>
                        <span class="btn-text">ÂÖ¥Ë∂£ËØæË∂ÖÊ£í</span>
                        <span class="btn-score">+2</span>
                    </button>
                    <button class="action-btn btn-hug" data-score="-1">
                        <span class="btn-emoji">ü´Ç</span>
                        <span class="btn-text">ÈúÄË¶ÅÊä±Êä±</span>
                        <span class="btn-score">-1</span>
                    </button>
                </div>
            </div>
        </div>

        <section class="section calendar-section">
            <div class="section-card">
                <div class="section-title">üìÖ ÂãáÊ∞îÊó•ÂéÜ ¬∑ Courage Calendar</div>
                <div class="calendar-stats-bar">
                    <div class="stat-item">
                        <span class="stat-icon">üçä</span>
                        <span class="stat-label">Á¥ØËÆ°Ê°îÂ≠ê</span>
                        <span class="stat-value" id="totalOranges">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-icon">üéÅ</span>
                        <span class="stat-label">Á¥ØËÆ°Á§ºÁâ©</span>
                        <span class="stat-value" id="totalPrizes">0</span>
                    </div>
                </div>
                <div class="calendar">
                    <div class="calendar-header">
                        <button class="month-nav-btn" id="prevMonthBtn">‚óÄ</button>
                        <span id="calendarMonthLabel">2025 Âπ¥ 11 Êúà</span>
                        <button class="month-nav-btn" id="nextMonthBtn">‚ñ∂</button>
                    </div>
                    <div class="calendar-grid" id="calendarWeekdays"></div>
                    <div class="calendar-grid" id="calendarGrid"></div>
                </div>
            </div>
        </section>
    </div>

    <div class="floating-feedback" id="floatingFeedback"></div>
    <div class="floating-loss" id="floatingLoss"></div>

    <div class="encourage-tip" id="tipOverlay">
        <div class="tip-card">
            Áà∏Áà∏Áà±‰Ω†ÔºåÊä±‰∏Ä‰∏ãÔºÅü´Ç<br>‰ªäÂ§©ÁöÑÂ∞èÂ∞èÊ≥™Ê∞¥ÔºåÊòéÂ§©‰ºöÂèòÂãáÊï¢„ÄÇ
        </div>
    </div>

    <div class="modal" id="prizeModal">
        <div class="modal-card">
            <h2>üéâ ÊÅ≠ÂñúÊ°îÂ≠êÔºÅ</h2>
            <p>‰Ω†ÊîíÊª°‰∫Ü 7 ‰∏™Ê°îÂ≠êÔºåËé∑ÂæóÁ§ºÁâ©Âï¶ÔºÅüéÅüí™</p>
            <button class="modal-close" id="closeModal">Â§™Ê£íÂï¶ÔºÅ</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script>
        const STORAGE_KEY = 'juzi_game_data';
        const MAX_PROGRESS = 7;
        const WEEK_DAYS = ['Êó•','‰∏Ä','‰∫å','‰∏â','Âõõ','‰∫î','ÂÖ≠'];

        const progressHintEl = document.getElementById('progressHint');
        const progressFillEl = document.getElementById('progressFill');
        const totalOrangesEl = document.getElementById('totalOranges');
        const totalPrizesEl = document.getElementById('totalPrizes');
        const actionButtonsEl = document.getElementById('actionButtons');
        const tipOverlay = document.getElementById('tipOverlay');
        const prizeModal = document.getElementById('prizeModal');
        const closeModal = document.getElementById('closeModal');
        const calendarMonthLabelEl = document.getElementById('calendarMonthLabel');
        const calendarWeekdaysEl = document.getElementById('calendarWeekdays');
        const calendarGridEl = document.getElementById('calendarGrid');
        const dateHintEl = document.getElementById('dateHint');
        const prevMonthBtn = document.getElementById('prevMonthBtn');
        const nextMonthBtn = document.getElementById('nextMonthBtn');

        // ÂΩìÂâçÈÄâ‰∏≠ÁöÑÊó•ÊúüÁä∂ÊÄÅÔºàÁî®‰∫éË°•ÂΩïÔºâ
        let currentSelectedDate = null;
        
        // ÂΩìÂâçÊòæÁ§∫ÁöÑÊúà‰ªΩÔºàÁî®‰∫éÊó•ÂéÜËßÜÂõæÔºâ
        let currentDisplayDate = new Date();

        /* ---------- Êó•Êúü & Â≠òÂÇ® ---------- */
        function formatDate(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }

        function getToday() {
            return new Date();
        }

        function getStartOfWeek(date = new Date()) {
            const day = date.getDay();
            const diff = day === 0 ? -6 : 1 - day; // Monday as start, Sunday as last day
            const monday = new Date(date);
            monday.setHours(0, 0, 0, 0);
            monday.setDate(date.getDate() + diff);
            return monday;
        }

        function getWorkWeekDates(reference = new Date()) {
            const monday = getStartOfWeek(reference);
            return Array.from({ length: 5 }, (_, i) => {
                const day = new Date(monday);
                day.setDate(monday.getDate() + i);
                return day;
            });
        }

        function initSelectedDate() {
            currentSelectedDate = getToday();
        }

        function updateDateHint() {
            // Â¶ÇÊûú currentSelectedDate ‰∏∫Á©∫ÔºåÂõûÈÄÄÂà∞‰ªäÂ§©
            const targetDate = currentSelectedDate || getToday();
            const weekdayLabels = ['Âë®Êó•', 'Âë®‰∏Ä', 'Âë®‰∫å', 'Âë®‰∏â', 'Âë®Âõõ', 'Âë®‰∫î', 'Âë®ÂÖ≠'];
            const dayOfWeek = targetDate.getDay();
            const month = targetDate.getMonth() + 1;
            const day = targetDate.getDate();
            const label = weekdayLabels[dayOfWeek];
            dateHintEl.textContent = `üìù Ê≠£Âú®ËÆ∞ÂΩïÔºö${label} (${month}Êúà${day}Êó•)`;
        }

        function loadGameData() {
            try {
                const data = JSON.parse(localStorage.getItem(STORAGE_KEY));
                if (!data) {
                    return {
                        currentProgress: 0,
                        totalOranges: 0,
                        totalPrizes: 0,
                        history: {}
                    };
                }
                // Á°Æ‰øùÊï∞ÊçÆÁªìÊûÑÂÆåÊï¥
                return {
                    currentProgress: data.currentProgress || 0,
                    totalOranges: data.totalOranges || 0,
                    totalPrizes: data.totalPrizes || 0,
                    history: data.history || {}
                };
            } catch {
                return {
                    currentProgress: 0,
                    totalOranges: 0,
                    totalPrizes: 0,
                    history: {}
                };
            }
        }

        function saveGameData(data) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }

        /* ---------- Ê∏∏ÊàèÈÄªËæë ---------- */
        function updateProgress(score) {
            const data = loadGameData();
            const dateStr = formatDate(currentSelectedDate || getToday());
            
            // Êõ¥Êñ∞ËøõÂ∫¶
            data.currentProgress += score;
            if (data.currentProgress < 0) data.currentProgress = 0;
            if (data.currentProgress > MAX_PROGRESS) data.currentProgress = MAX_PROGRESS;
            
            // Êõ¥Êñ∞Á¥ØËÆ°Ê°îÂ≠ê
            data.totalOranges += score;
            
            // Êõ¥Êñ∞ÂéÜÂè≤ËÆ∞ÂΩï
            if (!data.history[dateStr]) {
                data.history[dateStr] = { score: 0, hasPrize: false };
            }
            data.history[dateStr].score += score;
            
            // Ê£ÄÊü•ÊòØÂê¶ËææÂà∞Â•ñÂä±
            if (data.currentProgress >= MAX_PROGRESS) {
                data.totalPrizes += 1;
                data.currentProgress = 0;
                data.history[dateStr].hasPrize = true;
                triggerConfetti();
                openPrizeModal();
            }
            
            saveGameData(data);
            refreshUI();
        }

        function renderProgress(data) {
            const progress = data.currentProgress;
            const percentage = (progress / MAX_PROGRESS) * 100;
            const remaining = MAX_PROGRESS - progress;
            
            progressFillEl.style.width = `${percentage}%`;
            progressHintEl.textContent = `Ë∑ùÁ¶ªÁ§ºÁâ©ËøòÊúâ ${remaining} ‰∏™Ê°îÂ≠ê`;
            
            totalOrangesEl.textContent = data.totalOranges;
            totalPrizesEl.textContent = data.totalPrizes;
        }

        /* ---------- Êó•ÂéÜ ---------- */
        function renderCalendar(data) {
            const today = getToday(); // Áî®‰∫éÈ´ò‰∫Æ"‰ªäÂ§©"
            const currentYear = currentDisplayDate.getFullYear();
            const currentMonth = currentDisplayDate.getMonth(); // 0 index

            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const firstWeekday = firstDay.getDay();
            const daysInMonth = lastDay.getDate();

            calendarMonthLabelEl.textContent = `${currentYear} Âπ¥ ${currentMonth + 1} Êúà`;

            calendarWeekdaysEl.innerHTML = WEEK_DAYS.map(day => `
                <div class="calendar-weekday">${day}</div>
            `).join('');

            calendarGridEl.innerHTML = '';

            for (let i = 0; i < firstWeekday; i++) {
                const cell = document.createElement('div');
                calendarGridEl.appendChild(cell);
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const dateObj = new Date(currentYear, currentMonth, day);
                const key = formatDate(dateObj);
                const record = data.history[key];
                const cell = document.createElement('div');
                cell.className = 'calendar-cell';

                const score = record ? record.score : 0;
                if (score > 0) {
                    cell.classList.add('success');
                } else if (score < 0) {
                    cell.classList.add('fail');
                }

                if (formatDate(today) === key) {
                    cell.classList.add('today');
                }

                // Êó•ÊúüÊ†áÁ≠æÔºàÂ∑¶‰∏äËßíÔºâ
                const label = document.createElement('div');
                label.className = 'calendar-day-label';
                label.textContent = day;

                // Âçï‰∏ÄÂõæÊ†áÂéüÂàôÔºö‰ºòÂÖàÁ∫ß Á§ºÁâ© > Âì≠ËÑ∏ > Ê©òÂ≠ê
                let iconEmoji = '';
                let showCount = false;
                let countValue = 0;
                
                if (record && record.hasPrize) {
                    // ‰ºòÂÖàÁ∫ßÊúÄÈ´òÔºöÁ§ºÁâ©
                    iconEmoji = 'üéÅ';
                } else if (score < 0) {
                    // ‰ºòÂÖàÁ∫ßÁ¨¨‰∫åÔºöÂì≠ËÑ∏
                    iconEmoji = 'üò¢';
                } else if (score > 1) {
                    // ‰ºòÂÖàÁ∫ßÁ¨¨‰∏âÔºöÊ©òÂ≠êÔºàÂ§ö‰∏™Ôºâ
                    iconEmoji = 'üçä';
                    showCount = true;
                    countValue = score;
                } else if (score === 1) {
                    // Âçï‰∏™Ê©òÂ≠êÔºå‰∏çÊòæÁ§∫Êï∞Â≠ó
                    iconEmoji = 'üçä';
                }

                // ÂàõÂª∫ÂõæÊ†áÂÖÉÁ¥†ÔºàÂ±Ö‰∏≠ÊòæÁ§∫Ôºâ
                if (iconEmoji) {
                    const iconContainer = document.createElement('div');
                    iconContainer.className = record && record.hasPrize ? 'calendar-prize' : 'calendar-emoji';
                    
                    const iconEl = document.createElement('span');
                    iconEl.className = 'cal-icon';
                    iconEl.textContent = iconEmoji;
                    iconContainer.appendChild(iconEl);
                    
                    // Â¶ÇÊûúscore > 1ÔºåÊòæÁ§∫Êï∞Èáè
                    if (showCount) {
                        const countEl = document.createElement('span');
                        countEl.className = 'cal-count';
                        countEl.textContent = `+${countValue}`;
                        iconContainer.appendChild(countEl);
                    }
                    
                    cell.appendChild(iconContainer);
                }

                // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂ÈÄâÊã©Êó•Êúü
                cell.style.cursor = 'pointer';
                cell.addEventListener('click', () => {
                    currentSelectedDate = dateObj;
                    refreshUI();
                });

                // Â¶ÇÊûúÊòØÈÄâ‰∏≠ÁöÑÊó•ÊúüÔºåÊ∑ªÂä†È´ò‰∫Æ
                const selectedKey = currentSelectedDate ? formatDate(currentSelectedDate) : null;
                if (key === selectedKey) {
                    cell.style.border = '2px solid var(--pink)';
                    cell.style.boxShadow = '0 0 0 2px rgba(255, 105, 180, 0.3)';
                }

                cell.appendChild(label);
                calendarGridEl.appendChild(cell);
            }
        }

        function changeMonth(offset) {
            currentDisplayDate.setMonth(currentDisplayDate.getMonth() + offset);
            const data = loadGameData();
            renderCalendar(data);
        }

        /* ---------- ‰∫§‰∫í ---------- */
        function vibrate(pattern) {
            if ('vibrate' in navigator) {
                navigator.vibrate(pattern);
            }
        }

        function triggerConfetti(options = {}) {
            if (typeof confetti !== 'function') return;
            const defaultOptions = {
                particleCount: 160,
                spread: 80,
                origin: { y: 0.6 },
                colors: ['#FF69B4', '#FFB6C1', '#9370DB', '#B39DDB']
            };
            confetti({ ...defaultOptions, ...options });
        }

        function showFloatingFeedback(emoji, isMega = false) {
            const feedbackEl = document.getElementById('floatingFeedback');
            feedbackEl.textContent = emoji;
            
            // Ê∏ÖÈô§‰πãÂâçÁöÑÁ±ª
            feedbackEl.classList.remove('active', 'mega-pop');
            
            // Â¶ÇÊûúÊòØ+2ÔºåÊ∑ªÂä†mega-popÁ±ª
            if (isMega) {
                feedbackEl.classList.add('mega-pop');
            }
            
            // Ëß¶ÂèëÂä®Áîª
            feedbackEl.classList.add('active');
            
            // Âª∂ÈïøÁßªÈô§Êó∂Èó¥Âà∞2.5Áßí
            setTimeout(() => {
                feedbackEl.classList.remove('active', 'mega-pop');
            }, 2500);
        }

        function showFloatingLoss() {
            const lossEl = document.getElementById('floatingLoss');
            lossEl.textContent = 'üçä';
            
            // Ê∏ÖÈô§‰πãÂâçÁöÑÁ±ª
            lossEl.classList.remove('active');
            
            // Ëß¶ÂèëÂä®Áîª
            lossEl.classList.add('active');
            
            // 1.5ÁßíÂêéÁßªÈô§
            setTimeout(() => {
                lossEl.classList.remove('active');
            }, 1500);
        }

        function showTip() {
            tipOverlay.classList.add('active');
            setTimeout(() => tipOverlay.classList.remove('active'), 2200);
        }

        function openPrizeModal() {
            prizeModal.classList.add('active');
        }

        function closePrizeModal() {
            prizeModal.classList.remove('active');
        }

        function handleAction(score) {
            if (!currentSelectedDate) {
                currentSelectedDate = getToday();
            }
            
            if (score === -1) {
                // ÈúÄË¶ÅÊä±Êä± - ÊòæÁ§∫Â§±ÂéªÊ©òÂ≠êÁöÑÂä®Êïà
                showTip();
                showFloatingLoss();
                vibrate([50, 50, 50]);
            } else if (score === 1) {
                // +1 ÊåâÈíÆÔºöËΩªÈáèÊííËä± + ÂºπË∑≥Âä®Áîª
                triggerConfetti({
                    particleCount: 60,
                    spread: 60
                });
                showFloatingFeedback('üçä', false);
                vibrate(200);
            } else if (score === 2) {
                // +2 ÊåâÈíÆÔºöË±™ÂçéÈáëËâ≤ÊííËä± + ÂºπË∑≥Âä®ÁîªÔºàÊõ¥Â§ßÊõ¥Âçé‰∏ΩÔºâ
                triggerConfetti({
                    particleCount: 120,
                    spread: 80,
                    colors: ['#FFD700', '#FFA500']
                });
                showFloatingFeedback('üåüüçäüåü', true);
                vibrate(200);
            }
            
            updateProgress(score);
        }

        tipOverlay.addEventListener('click', () => tipOverlay.classList.remove('active'));
        
        // ÁªëÂÆöÊìç‰ΩúÊåâÈíÆ‰∫ã‰ª∂
        actionButtonsEl.querySelectorAll('.action-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const score = parseInt(btn.dataset.score);
                handleAction(score);
            });
        });
        
        closeModal.addEventListener('click', closePrizeModal);
        prizeModal.addEventListener('click', (e) => {
            if (e.target === prizeModal) closePrizeModal();
        });

        // ÁªëÂÆöÊúà‰ªΩÂàáÊç¢ÊåâÈíÆ‰∫ã‰ª∂
        prevMonthBtn.addEventListener('click', () => {
            changeMonth(-1);
            vibrate(50);
        });
        
        nextMonthBtn.addEventListener('click', () => {
            changeMonth(1);
            vibrate(50);
        });

        function refreshUI() {
            const data = loadGameData();
            renderProgress(data);
            renderCalendar(data);
            updateDateHint();
        }

        // ÂàùÂßãÂåñ
        initSelectedDate();
        refreshUI();
    </script>
</body>
</html>
